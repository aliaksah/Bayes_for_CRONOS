---
title: "Proportion of literacy deprived students per school"
output:
  html_notebook: default
  html_document:
    df_print: paged
  pdf_document: default
  word_document: default
---
# Load R packages
```{r}
source("RFiles/packages.r")
```

# Load  single imputed PISA data.
```{r}
load(file = file.path("Orgdata/IMPDAT_PISA.RData"))
```

# Prepare data, thus build PISA scales, 6489 students and 70 variables
```{r}
source("RFiles/01data_preperation.r")
to.rm <- objects()[!objects() %in% c("PPath","pisa18","countries")]
rm(list = to.rm)
# head(pisa18)
# dim(pisa18)
```


# There should be at least ten students per school. Schools with fewer observations are excluded from the analysis. The variable nb.stud informs about the number of stundets per school and save final data set

```{r}
tab.id <- table(pisa18$school.id)
id.frame <- as.data.frame(tab.id)

nb.stud <- rep(id.frame$Freq,id.frame$Freq)
pisa18$nb.stud <- nb.stud
rm(tab.id,id.frame,nb.stud)
pisa.data <- subset(pisa18, pisa18$nb.stud > 9)
pisa18 <- pisa.data

rm(pisa.data)
#summary(pisa18$nb.stud)
save(pisa18,file = "Files/pisa18.RData")
```


# Data sets for schools: Data set contains one row for each school and only school level variables
```{r}
sc.level <- names(pisa18) == toupper(names(pisa18))
sc.level[1] <- TRUE
pisa18_sc <- pisa18[,sc.level]
dim(pisa18_sc)
pisa18_sc <- pisa18[!duplicated(pisa18_sc$school.id), ]
dim(pisa18_sc)

save(pisa18,file = "Files/pisa18_sc.RData")
```











