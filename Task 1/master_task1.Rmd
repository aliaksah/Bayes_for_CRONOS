---
title: "Task 1"
output: html_notebook
---

# Load single imputed PISA data and prepare it, thus build PISA scales.
```{r}
source("packages.r")
load(file = file.path("IMPDAT_PISA.RData"))
```

# Prepare data
```{r}
source("01data_preperation.r")
to.rm <- objects()[!objects() %in% c("PPath","pisa18","countries")]
rm(list = to.rm)
head(pisa18)

```


# There should be at least ten students per school. Schools with fewer observations are 
# excluded from the analysis. The variable nb.stud informs about the number of stundets
# per school

```{r}
tab.id <- table(pisa18$school.id)
id.frame <- as.data.frame(tab.id)

nb.stud <- rep(id.frame$Freq,id.frame$Freq)
pisa18$nb.stud <- nb.stud
rm(tab.id,id.frame,nb.stud)
pisa.data <- subset(pisa18, pisa18$nb.stud > 9)
pisa18 <- pisa.data

rm(pisa.data)
summary(pisa18$nb.stud)
```

# Only one row per school, remove duplicated rows. The data set has one row for each school, there are 284 schools in der data set.

```{r}
pisa18_sc <- pisa18[!duplicated(pisa18$school.id), ]
rm(pisa18)
View(pisa18_sc)

dim(pisa18_sc)
```
# Plot the outcome distribution
```{r}

#pdf("outcomeLDFRAC.pdf")
#hist(pisa18_sc$LDFRAC, col = "darkgrey", border = F, main = "Distribution of Outcome Variable", xlab = "LDFRAC", breaks = 20, freq = F)
ggplot(pisa18_sc, aes(LDFRAC)) +
  geom_histogram(alpha = 0.5, aes(y = ..density..), position = 'identity') + ggtitle("Distribution of Outcome Variable")
#dev.off()

```
# Desciptive summary



```{r}
ggplot(pisa18_sc, aes(LDFRAC, fill = factor(DISHOME))) +
  geom_histogram(alpha = 0.5, aes(y = ..density..), position = 'identity')
```






```{r}
ggplot(pisa18_sc, aes(LDFRAC, fill = factor(STAFFLACK))) +
  geom_histogram(alpha = 0.5, aes(y = ..density..), position = 'identity')
```


```{r}
ggplot(pisa18_sc[pisa18_sc$UNI01==0,], aes(LDFRAC, fill = factor(STAFFLACK))) +
  geom_histogram(alpha = 0.5, aes(y = ..density..), position = 'identity')
```



